Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка, Дата ИЗ Документ.БезТабличныхЧастей ГДЕ НЕ Проведен И НЕ ПометкаУдаления");
Выб = Запрос.Выполнить().Выбрать(); Выб.Следующий();
// выполнять в управляемом режиме
// перед выполнением проверить, что эскалация на СУБД не отключена (T1224 или T1211)
// перед окончанием данной транзакции попробовать провести любой другой "Документ.БезТабличныхЧастей",
// либо отменить проведение любого документа "Документ.БезТабличныхЧастей"
// убедиться, что будет ожидание на блокировке, так как эскалация заблокировала таблицу документа целиком
// можно в трассировке посмотреть события Lock_acquired (с фильтром Duration > 0), Lock_timeout, Blocked_process_report 

НачатьТранзакцию();
	
	// РегистрНакопления.Остаточный 
	Набор = РегистрыНакопления.Остаточный.СоздатьНаборЗаписей();
	Набор.Отбор.Регистратор.Установить(Выб.Ссылка);
	
	Для Инд = 1 По 5000 Цикл
		Стр = Набор.Добавить(); 
		Стр.Регистратор = Выб.Ссылка; 
		Стр.Период = Выб.Дата; 
		Стр.Склад = Справочники.Склады.Оптовый;
		Стр.НомерЯчейки = Инд; 
		Стр.Количество = 1;
	КонецЦикла;	
	
	Набор.Записать(Ложь); 
	
	Предупреждение("Записали набор РегистрНакопления.Остаточный");
	
ОтменитьТранзакцию();
