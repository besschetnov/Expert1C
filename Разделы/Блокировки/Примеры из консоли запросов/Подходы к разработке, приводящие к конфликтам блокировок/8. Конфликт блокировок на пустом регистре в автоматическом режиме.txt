// выполнить в АВТОМАТИЧЕСКОМ режиме блокировок
// блокировка возникнет, так как из за уровня изоляции SERIALIZABLE таблица будет заблокирована целиком
// решение - перевести конфигурацию в управляемый режим блокировок

Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 2 Ссылка, Дата, Товар ИЗ Документ.РегистраторПустогоРегистра");
ТаблицаЗапроса = Запрос.Выполнить().Выгрузить();
ТаблицаЗапроса.Сортировать("Дата ВОЗР"); // во втором окне заменить ВОЗР на УБЫВ
ТаблицаЗапроса.ВыбратьСтроку();

НачатьТранзакцию();

	Док = ТаблицаЗапроса[0].Ссылка;	// во втором окне используем вторую запись
	Период = ТаблицаЗапроса[0].Дата; 
	Товар = ТаблицаЗапроса[0].Товар; 
	
	Набор = РегистрыНакопления.ПустойРегистр.СоздатьНаборЗаписей();
	Набор.Отбор.Регистратор.Установить(Док);
	
	Стр = Набор.Добавить();
	Стр.ВидДвижения = ВидДвиженияНакопления.Приход;
	Стр.Регистратор = Док;
	Стр.Период = Период;
	Стр.Товар = Товар;
	Стр.Количество = 1;
	
	Набор.Записать();

	Предупреждение("Записали набор");
	
ОтменитьТранзакцию();
