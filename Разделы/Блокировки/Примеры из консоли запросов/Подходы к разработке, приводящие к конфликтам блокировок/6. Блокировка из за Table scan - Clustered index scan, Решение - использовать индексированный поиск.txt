// выполнять в УПРАВЛЯЕМОМ режиме блокировок в режиме совместимости с 8.2
// сначала в первом окне выполнить код для Транзакция 1, 
// после этого во втором окне - код для Транзакция 2
// поскольку поле НомерЯчейки проиндексирвоано, 
// избыточных блокировок при чтении не будет

// Транзакция 1
НачатьТранзакцию();

	Запрос = Новый Запрос("
	|ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка 
	|ИЗ Документ.БезТабличныхЧастей ГДЕ НомерЯчейки = 1");
	
	Выб = Запрос.Выполнить().Выбрать(); 
	Выб.Следующий();
	
	Объект = Выб.Ссылка.ПолучитьОбъект();
	Объект.Записать(); // X блокировка на один документ при записи

	Предупреждение("Записали документ ("+Объект+")");
	
ОтменитьТранзакцию();

// Транзакция 2
НачатьТранзакцию();
	
	Запрос = Новый Запрос("
	|ВЫБРАТЬ КОЛИЧЕСТВО(НомерЯчейки) КАК Записей 
	|ИЗ Документ.БезТабличныхЧастей ГДЕ НомерЯчейки > 1");
	// выбираем записи по всем НомерЯчейки, кроме 1
	// данные не пересекаются
	// при этом поле НомерЯчейки проиндексировано, поэтому избыточной блокировки не будет
	Запрос.Выполнить(); 
	Предупреждение("Выполнен запрос");
	
ОтменитьТранзакцию();
