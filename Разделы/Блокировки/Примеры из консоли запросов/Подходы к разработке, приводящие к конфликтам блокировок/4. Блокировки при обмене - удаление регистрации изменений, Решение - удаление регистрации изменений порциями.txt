
ТекстЗапроса = "";
Для Каждого Элемент Из Метаданные.ПланыОбмена.Документы.Состав Цикл
	Если Метаданные.Документы.Содержит(Элемент.Метаданные) Тогда 
		ТекстЗапроса = ТекстЗапроса + ?(ТекстЗапроса="", "", " ОБЪЕДИНИТЬ ВСЕ") + Символы.ПС + 
		"ВЫБРАТЬ Ссылка ИЗ Документ."+Элемент.Метаданные.Имя+".Изменения"; 
	КонецЕсли;
КонецЦикла;

ЗапросВыборкиИзменений = Новый Запрос(ТекстЗапроса); ЭлементыФормы.ТекстЗапроса.УстановитьТекст(ТекстЗапроса); // для демонстрации результата
Выб = ЗапросВыборкиИзменений.Выполнить().Выбрать();

Узел = ПланыОбмена.Документы.НайтиПоКоду("Выгружено");

МассивИзменений = Новый Массив;

// удаляем регистрацию изменений порциями
Инд = 0; РазмерПорции = 10;

Пока Выб.Следующий() Цикл
	
	Инд = Инд + 1;
	
	Если Инд%РазмерПорции = 0 Тогда
		// удаляем порцию изменений с узла обмена
		ПланыОбмена.УдалитьРегистрациюИзменений(Узел, МассивИзменений);
		МассивИзменений.Очистить();
	Иначе
		// добавляем в массив очередное изменение
		МассивИзменений.Добавить(Выб.Ссылка);
	КонецЕсли;
	
КонецЦикла;
