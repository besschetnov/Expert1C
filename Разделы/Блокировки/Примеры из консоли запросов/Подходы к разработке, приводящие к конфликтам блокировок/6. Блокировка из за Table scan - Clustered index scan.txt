// выполнять в УПРАВЛЯЕМОМ режиме блокировок в режиме совместимости с 8.2
// сначала в первом окне выполнить код для Транзакция 1, 
// после этого во втором окне - код для Транзакция 2
// будет блокировка СУБД, она исчезнет после того, 
// как перейдем в режим полной совместимости с 8.3 (RCSI),
// либо нужно проиндексировать поле Товар

// Транзакция 1
НачатьТранзакцию();

	Запрос = Новый Запрос("
	|ВЫБРАТЬ ПЕРВЫЕ 1 Ссылка 
	|ИЗ Документ.БезТабличныхЧастей ГДЕ Товар = &Товар");
	
	Запрос.Параметры.Вставить("Товар", Справочники.Товары.Смартфон);
	
	Выб = Запрос.Выполнить().Выбрать(); 
	Выб.Следующий();
	
	Объект = Выб.Ссылка.ПолучитьОбъект();
	Объект.Записать(); // X блокировка на один документ при записи

	Предупреждение("Записали документ ("+Объект+")");
	
ОтменитьТранзакцию();

// Транзакция 2
НачатьТранзакцию();
	
	Запрос = Новый Запрос("
	|ВЫБРАТЬ КОЛИЧЕСТВО(Товар) КАК Записей 
	|ИЗ Документ.БезТабличныхЧастей ГДЕ Товар = &Товар");
	// выбираем записи по другому товару: в предыдущей транзакции Смартфон, в этой - Ноутбук
	// данные не пересекаются
	Запрос.Параметры.Вставить("Товар", Справочники.Товары.Ноутбук);
	
	// поле Товар не проиндексировано, поэтому запрос просканирует всю таблицу документа
	// перед чтением каждой записи будет попытка установить S блокировку
	// запрос будет читать записи до тех пор, пока не наткнется на документ, заблокированный в Транзакции 1
	Запрос.Выполнить(); 
	Предупреждение("Выполнен запрос");
	
ОтменитьТранзакцию();
