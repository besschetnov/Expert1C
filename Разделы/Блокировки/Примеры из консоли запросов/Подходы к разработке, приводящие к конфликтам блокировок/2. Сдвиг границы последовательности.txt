// выполнить в двух окнах, во втором окне выбирать ссылки в обратном порядке
// сначала выполнить шаг в первом окне, затем шаг во втором окне
// блокировка будет из за того, что граница последовательности без измерений - одна запись, ее нельзя менять одновременно в двух транзакциях
// а в примере ниже - используется последовательность с низкоселективным измерением "Склад", значения измерения совпадают
// одно из решений - использовать высокоселективные измерения у последовательности
// например "Номенклатура", "Контрагент", "ДоговорКонтрагента"
// также - не двигать границу последовательности при проведении документов
Запрос = Новый Запрос("ВЫБРАТЬ ПЕРВЫЕ 2 Ссылка, Дата, Склад ИЗ Документ.БезТабличныхЧастей ГДЕ Проведен И Склад = ЗНАЧЕНИЕ(Справочник.Склады.Оптовый)");
ТаблицаЗапроса = Запрос.Выполнить().Выгрузить();
ТаблицаЗапроса.Сортировать("Дата ВОЗР"); // во втором окне заменить ВОЗР на УБЫВ
ТаблицаЗапроса.ВыбратьСтроку();

НачатьТранзакцию();
	// во втором окне используем вторую запись результата запроса, в первом окне - первую 
	Док = ТаблицаЗапроса[0].Ссылка; 
	ДатаДок = ТаблицаЗапроса[0].Дата;
	Склад = ТаблицаЗапроса[0].Склад;
	
	// 1. регистрация документа в последовательности
	Набор = Последовательности.Тестовая.СоздатьНаборЗаписей();
	Набор.Отбор.Регистратор.Установить(Док);
	Стр = Набор.Добавить();
	Стр.Регистратор = Док;
	Стр.Склад = Склад;
	Набор.Записать();
	
	Предупреждение("Шаг 1: Зарегистрировали документ в последовательности");
	
	// 2. сдвиг границы последовательности
	Отбор = Новый Структура("Склад", Склад);
	МоментВремени = Новый МоментВремени(ДатаДок, Док);
	Последовательности.Тестовая.УстановитьГраницу(МоментВремени, Отбор);
	
	Предупреждение("Шаг 2: Сдвинули границу последовательности");
																
ОтменитьТранзакцию();
